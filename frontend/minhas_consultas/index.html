<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Consultas - PsychoHelp</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #007f7f, #009999);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h2 {
            text-align: center;
            color: #ffcc66;
            margin-bottom: 30px;
        }
        
        .consultas-list {
            margin-bottom: 30px;
        }
        
        .consulta-card {
            background: #009999;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #ffcc66;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .consulta-card h3 {
            color: #ffcc66;
            margin-top: 0;
            border-bottom: 1px solid #ffcc66;
            padding-bottom: 10px;
        }
        
        .consulta-card p {
            margin: 8px 0;
            color: #ffe9b3;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #ffe9b3;
            background: #009999;
            border-radius: 15px;
            border: 2px solid #ffcc66;
        }
        
        .links {
            text-align: center;
            margin-top: 20px;
        }
        
        .links a {
            color: #ffcc66;
            text-decoration: none;
            font-weight: bold;
        }
        
        .links a:hover {
            text-decoration: underline;
        }
        
        /* Status colors */
        .consulta-card.agendada {
            border-left: 5px solid #ffcc66;
        }
        
        .consulta-card.confirmada {
            border-left: 5px solid #4CAF50;
        }
        
        .consulta-card.realizada {
            border-left: 5px solid #2196F3;
        }
        
        .consulta-card.cancelada {
            border-left: 5px solid #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ“… Minhas Consultas</h2>
        
        <div id="listaConsultas" class="consultas-list">
            <div class="loading">Carregando suas consultas...</div>
        </div>
        
        <div class="links">
            <a href="/home">â† Voltar para Home</a>
        </div>
    </div>

    <script>
        // Carregar consultas quando a pÃ¡gina abrir
        window.onload = carregarConsultas;

        async function carregarConsultas() {
            try {
                // ID temporÃ¡rio - depois pega da sessÃ£o
                const idCliente = 1;
                
                console.log('ğŸ”µ Buscando consultas para cliente:', idCliente);
                
                const response = await fetch(`/api/minhas-consultas/${idCliente}`);
                const consultas = await response.json();
                
                console.log('ğŸŸ¢ Consultas recebidas:', consultas);
                
                mostrarConsultas(consultas);
            } catch (error) {
                console.error('âŒ Erro ao carregar consultas:', error);
                document.getElementById('listaConsultas').innerHTML = 
                    '<div class="loading">Erro ao carregar consultas. Tente novamente.</div>';
            }
        }

        function mostrarConsultas(consultas) {
            const lista = document.getElementById('listaConsultas');
            
            if (!consultas || consultas.length === 0) {
                lista.innerHTML = `
                    <div class="loading">
                        <h3>ğŸ“­ Nenhuma consulta agendada</h3>
                        <p>Que tal agendar sua primeira consulta?</p>
                        <button onclick="window.location.href='/agendar'" 
                                style="background: #ffcc66; color: #007f7f; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 10px;">
                            ğŸ“… Agendar Consulta
                        </button>
                    </div>
                `;
                return;
            }
            
            lista.innerHTML = consultas.map(consulta => `
                <div class="consulta-card ${consulta.status}">
                    <h3>ğŸ‘¨â€âš•ï¸ ${consulta.nome_psicologo || 'PsicÃ³logo'}</h3>
                    <p><strong>ğŸ“… Data:</strong> ${formatarData(consulta.data_consulta)}</p>
                    <p><strong>â° HorÃ¡rio:</strong> ${formatarHorario(consulta.horario)}</p>
                    <p><strong>ğŸ“Š Status:</strong> ${formatarStatus(consulta.status)}</p>
                    <p><strong>ğŸ¯ Especialidade:</strong> ${consulta.especialidade || 'Geral'}</p>
                    ${consulta.observacoes ? `<p><strong>ğŸ“ ObservaÃ§Ãµes:</strong> ${consulta.observacoes}</p>` : ''}
                    ${consulta.telefone_psicologo ? `<p><strong>ğŸ“ Contato:</strong> ${consulta.telefone_psicologo}</p>` : ''}
                    
                </div>
            `).join('');
        }

        function formatarData(dataString) {
            if (!dataString) return 'Data nÃ£o informada';
            const data = new Date(dataString + 'T00:00:00');
            return data.toLocaleDateString('pt-BR');
        }

        function formatarHorario(horario) {
            if (!horario) return 'HorÃ¡rio nÃ£o informado';
            return horario;
        }

        function formatarStatus(status) {
            const statusMap = {
                'agendada': 'ğŸŸ¡ Agendada',
                'confirmada': 'ğŸŸ¢ Confirmada', 
                'realizada': 'ğŸ”µ Realizada',
                'cancelada': 'ğŸ”´ Cancelada'
            };
            return statusMap[status] || status;
        }

        function cancelarConsulta(idConsulta) {
            if (confirm('Tem certeza que deseja cancelar esta consulta?')) {
                alert('Funcionalidade de cancelamento em desenvolvimento! ğŸš§');
            }
        }

        function verDetalhes(idConsulta) {
            alert('Detalhes da consulta em desenvolvimento! ğŸš§');
        }
    </script>
</body>
</html>