<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Psic√≥logo - PsicoHelp</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }
        
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255, 204, 102, 0.3);
            z-index: 1;
        }
        
        .progress-step {
            text-align: center;
            flex: 1;
            position: relative;
            z-index: 2;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: #007f7f;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: bold;
            border: 3px solid #ffcc66;
        }
        
        .step-number.active {
            background: #ffcc66;
            color: #007f7f;
        }
        
        .step-label {
            color: #ffcc66;
            font-weight: bold;
        }
        
        .form-section {
            display: none;
        }
        
        .form-section.active {
            display: block;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 20px;">
            <h1>üë®‚Äç‚öïÔ∏è Cadastro de Psic√≥logo</h1>
        </div>
        
        <!-- Barra de Progresso -->
        <div class="progress-bar">
            <div class="progress-step">
                <div class="step-number active" id="step1">1</div>
                <div class="step-label">Dados Pessoais</div>
            </div>
            <div class="progress-step">
                <div class="step-number" id="step2">2</div>
                <div class="step-label">Dados Profissionais</div>
            </div>
        </div>
        
        <form id="formCadastro">
            <!-- Se√ß√£o 1: Dados Pessoais -->
            <div id="section1" class="form-section active">
                <h3>Dados Pessoais</h3>
                
                <label for="nome">Nome Completo:</label>
                <input type="text" id="nome" placeholder="Seu nome completo" required>
                
                <label for="email">Email:</label>
                <input type="email" id="email" placeholder="seu@email.com" required>
                
                <label for="telefone">Telefone:</label>
                <input type="tel" id="telefone" placeholder="(11) 99999-9999" required>
                
                <label for="senha">Senha:</label>
                <input type="password" id="senha" placeholder="M√≠nimo 6 caracteres" required minlength="6">
                
                <label for="confirmarSenha">Confirmar Senha:</label>
                <input type="password" id="confirmarSenha" placeholder="Digite a senha novamente" required minlength="6">
                
                <div class="nav-buttons">
                    <div></div>
                    <button type="button" class="btn" onclick="nextSection()">Pr√≥ximo ‚Üí</button>
                </div>
            </div>
            
            <!-- Se√ß√£o 2: Dados Profissionais -->
            <div id="section2" class="form-section">
                <h3>Dados Profissionais</h3>
                
                <label for="crp">N√∫mero do CRP:</label>
                <input type="text" id="crp" placeholder="Ex: 06/12345" required>
                
                <label for="especialidade">Especialidade Principal:</label>
                <input type="text" id="especialidade" placeholder="Ex: Psicologia Cl√≠nica, TCC, Infantil" required>
                
                <label for="formacao">Forma√ß√£o Acad√™mica:</label>
                <textarea id="formacao" placeholder="Ex: Gradua√ß√£o em Psicologia - USP" required></textarea>
                
                <label for="abordagem">Abordagem Terap√™utica:</label>
                <select id="abordagem" required>
                    <option value="">Selecione uma abordagem</option>
                    <option value="TCC">Terapia Cognitivo-Comportamental (TCC)</option>
                    <option value="Psican√°lise">Psican√°lise</option>
                    <option value="Humanista">Abordagem Humanista</option>
                    <option value="Sist√™mica">Terapia Sist√™mica</option>
                    <option value="Gestalt">Gestalt-terapia</option>
                    <option value="Outra">Outra</option>
                </select>
                
                <label for="experiencia">Anos de Experi√™ncia:</label>
                <input type="number" id="experiencia" placeholder="Ex: 5" min="0" max="50">
                
                <label for="sobre">Sobre voc√™:</label>
                <textarea id="sobre" placeholder="Fale um pouco sobre sua experi√™ncia, abordagem e especialidades..."></textarea>
                
                <div id="mensagemErro" class="error-message" style="display: none;"></div>
                
                <div class="nav-buttons">
                    <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Voltar</button>
                    <button type="submit" class="btn">‚úÖ Finalizar Cadastro</button>
                </div>
            </div>
        </form>
    </div>
    
    <script>
        let currentSection = 1;
        
        // Navega√ß√£o entre se√ß√µes
        function nextSection() {
            // Validar se√ß√£o atual
            if (currentSection === 1) {
                const nome = document.getElementById('nome').value.trim();
                const email = document.getElementById('email').value.trim();
                const telefone = document.getElementById('telefone').value.trim();
                const senha = document.getElementById('senha').value;
                const confirmarSenha = document.getElementById('confirmarSenha').value;
                
                if (!nome || !email || !telefone || !senha || !confirmarSenha) {
                    mostrarErro('Preencha todos os campos obrigat√≥rios.');
                    return;
                }
                
                if (senha.length < 6) {
                    mostrarErro('A senha deve ter no m√≠nimo 6 caracteres.');
                    return;
                }
                
                if (senha !== confirmarSenha) {
                    mostrarErro('As senhas n√£o coincidem.');
                    return;
                }
            }
            
            // Mudar se√ß√£o
            document.getElementById('section' + currentSection).classList.remove('active');
            document.getElementById('section' + (currentSection + 1)).classList.add('active');
            
            // Atualizar barra de progresso
            document.getElementById('step' + currentSection).classList.remove('active');
            document.getElementById('step' + (currentSection + 1)).classList.add('active');
            
            currentSection = 2;
        }
        
        function prevSection() {
            document.getElementById('section' + currentSection).classList.remove('active');
            document.getElementById('section' + (currentSection - 1)).classList.add('active');
            
            document.getElementById('step' + currentSection).classList.remove('active');
            document.getElementById('step' + (currentSection - 1)).classList.add('active');
            
            currentSection = 1;
        }
        
        // Formatar telefone
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            if (value.length > 10) {
                value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
            } else if (value.length > 6) {
                value = value.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
            } else if (value.length > 0) {
                value = value.replace(/^(\d*)$/, '($1');
            }
            
            e.target.value = value;
        });
        
        // Submit do formul√°rio
        document.getElementById('formCadastro').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const nome = document.getElementById('nome').value.trim();
            const email = document.getElementById('email').value.trim();
            const telefone = document.getElementById('telefone').value.trim().replace(/\D/g, '');
            const senha = document.getElementById('senha').value;
            const crp = document.getElementById('crp').value.trim();
            const especialidade = document.getElementById('especialidade').value.trim();
            const formacao = document.getElementById('formacao').value.trim();
            const abordagem = document.getElementById('abordagem').value;
            const experiencia = document.getElementById('experiencia').value || 0;
            const sobre = document.getElementById('sobre').value.trim();
            
            const errorDiv = document.getElementById('mensagemErro');
            const btn = this.querySelector('.btn[type="submit"]');
            
            errorDiv.style.display = 'none';
            
            if (!crp || !especialidade || !formacao || !abordagem) {
                mostrarErro('Preencha todos os campos profissionais obrigat√≥rios.');
                return;
            }
            
            btn.textContent = 'Cadastrando...';
            btn.disabled = true;
            
            try {
                const response = await fetch('/api/cadastro', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nome,
                        email,
                        senha,
                        telefone,
                        tipo: 'psicologo',
                        crp,
                        especialidade,
                        formacao,
                        abordagem,
                        experiencia,
                        sobre
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Psic√≥logo cadastrado com sucesso! Fa√ßa login para continuar.');
                    window.location.href = '/';
                } else {
                    mostrarErro(data.error);
                    btn.textContent = '‚úÖ Finalizar Cadastro';
                    btn.disabled = false;
                }
                
            } catch (error) {
                mostrarErro('Erro ao conectar com o servidor.');
                console.error('Erro:', error);
                btn.textContent = '‚úÖ Finalizar Cadastro';
                btn.disabled = false;
            }
        });
        
        function mostrarErro(mensagem) {
            const errorDiv = document.getElementById('mensagemErro');
            errorDiv.textContent = '‚ùå ' + mensagem;
            errorDiv.style.display = 'block';
        }
    </script>
</body>
</html>