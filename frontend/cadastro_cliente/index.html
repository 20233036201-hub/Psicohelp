<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Cliente - PsicoHelp</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 30px;">
            <h1>üë§ Cadastro de Cliente</h1>
            <p style="color: rgba(255, 255, 255, 0.8);">Cadastre-se para buscar ajuda psicol√≥gica</p>
        </div>
        
        <form id="formCadastro">
            <label for="nome">Nome Completo:</label>
            <input type="text" id="nome" placeholder="Seu nome completo" required>
            
            <label for="email">Email:</label>
            <input type="email" id="email" placeholder="seu@email.com" required>
            
            <label for="telefone">Telefone:</label>
            <input type="tel" id="telefone" placeholder="(11) 99999-9999">
            
            <label for="senha">Senha:</label>
            <input type="password" id="senha" placeholder="M√≠nimo 6 caracteres" required minlength="6">
            
            <label for="confirmarSenha">Confirmar Senha:</label>
            <input type="password" id="confirmarSenha" placeholder="Digite a senha novamente" required minlength="6">
            
            <div id="mensagemErro" class="error-message" style="display: none;"></div>
            
            <button type="submit" class="btn">‚úÖ Finalizar Cadastro</button>
            <button type="button" class="btn btn-secondary" onclick="window.location.href='/'">‚Üê Voltar para Login</button>
        </form>
    </div>
    
    <script>
        document.getElementById('formCadastro').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const nome = document.getElementById('nome').value.trim();
            const email = document.getElementById('email').value.trim();
            const telefone = document.getElementById('telefone').value.trim();
            const senha = document.getElementById('senha').value;
            const confirmarSenha = document.getElementById('confirmarSenha').value;
            const errorDiv = document.getElementById('mensagemErro');
            const btn = this.querySelector('.btn');
            
            // Limpar erros
            errorDiv.style.display = 'none';
            
            // Valida√ß√µes
            if (senha.length < 6) {
                mostrarErro('A senha deve ter no m√≠nimo 6 caracteres.');
                return;
            }
            
            if (senha !== confirmarSenha) {
                mostrarErro('As senhas n√£o coincidem.');
                return;
            }
            
            // Formatar telefone (remover formata√ß√£o)
            let telefoneFormatado = telefone.replace(/\D/g, '');
            
            btn.textContent = 'Cadastrando...';
            btn.disabled = true;
            
            try {
                const response = await fetch('/api/cadastro', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nome,
                        email,
                        senha,
                        telefone: telefoneFormatado,
                        tipo: 'cliente'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Cadastro realizado com sucesso! Fa√ßa login para continuar.');
                    window.location.href = '/';
                } else {
                    mostrarErro(data.error);
                    btn.textContent = '‚úÖ Finalizar Cadastro';
                    btn.disabled = false;
                }
                
            } catch (error) {
                mostrarErro('Erro ao conectar com o servidor.');
                console.error('Erro:', error);
                btn.textContent = '‚úÖ Finalizar Cadastro';
                btn.disabled = false;
            }
        });
        
        function mostrarErro(mensagem) {
            const errorDiv = document.getElementById('mensagemErro');
            errorDiv.textContent = '‚ùå ' + mensagem;
            errorDiv.style.display = 'block';
        }
        
        // Formatar telefone enquanto digita
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            if (value.length > 10) {
                value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
            } else if (value.length > 6) {
                value = value.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
            } else if (value.length > 0) {
                value = value.replace(/^(\d*)$/, '($1');
            }
            
            e.target.value = value;
        });
    </script>
</body>
</html>